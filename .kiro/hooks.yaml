version: 1
hooks:
  - name: "Run tests on save"
    trigger:
      type: "file_saved"
      pattern: "ghost-hunt/src/**/*.{ts,tsx}"
    action:
      type: "shell"
      command: "cd ghost-hunt && npm test -- --run"
    
  - name: "Type check on save"
    trigger:
      type: "file_saved"
      pattern: "ghost-hunt/src/**/*.{ts,tsx}"
    action:
      type: "shell"
      command: "cd ghost-hunt && npm run tsc -- --noEmit"
    
  - name: "Lint on save"
    trigger:
      type: "file_saved"
      pattern: "ghost-hunt/src/**/*.{ts,tsx}"
    action:
      type: "shell"
      command: "cd ghost-hunt && npm run lint"
  
  - name: "Create milestone branch on new spec"
    trigger:
      type: "file_saved"
      pattern: ".kiro/specs/*/design.md"
    action:
      type: "shell"
      command: |
        # Extract milestone number from path (e.g., 004-overworld-supplies-mvp)
        SPEC_DIR=$(dirname "$KIRO_FILE_PATH")
        MILESTONE=$(basename "$SPEC_DIR")
        
        # Check if branch already exists
        if ! git rev-parse --verify "$MILESTONE" >/dev/null 2>&1; then
          # Commit current changes
          git add .
          git commit -m "docs: Add design for milestone $MILESTONE" || true
          
          # Create and push new branch
          git branch "$MILESTONE"
          git push origin "$MILESTONE"
          
          echo "‚úÖ Created and pushed branch: $MILESTONE"
        else
          echo "‚ÑπÔ∏è Branch $MILESTONE already exists"
        fi
  
  - name: "Complete phase and merge to main"
    trigger:
      type: "manual"
    action:
      type: "message"
      message: |
        # üéâ Phase Completion Workflow
        
        When you finish a phase/milestone, run these commands:
        
        ```bash
        # 1. Commit all changes
        git add -A
        git commit -m "feat: Complete [Phase Name] (Spec XXX)
        
        - Brief summary of what was implemented
        - Key features added
        - All phases/tasks complete"
        
        # 2. Switch to main and merge
        git checkout main
        git merge [branch-name] --no-ff -m "Merge [branch-name]: [Phase Name] Complete"
        
        # 3. Push to remote
        git push origin main
        git push origin [branch-name]
        
        # 4. Switch back to feature branch for continued work
        git checkout [branch-name]
        ```
        
        ## Example (what we just did):
        ```bash
        git add -A
        git commit -m "feat: Complete Investigation Mode V2 overhaul (Spec 005)"
        git checkout main
        git merge 005-feature --no-ff -m "Merge 005-feature: Investigation Mode V2 Complete"
        git push origin main
        git push origin 005-feature
        git checkout 005-feature
        ```
        
        ## Best Practices:
        - ‚úÖ Keep feature branch alive for future iterations
        - ‚úÖ Use --no-ff to preserve branch history
        - ‚úÖ Write descriptive commit messages
        - ‚úÖ Merge to main only when phase is complete and tested
        - ‚úÖ Tag releases: `git tag v0.5.0 && git push origin v0.5.0`
